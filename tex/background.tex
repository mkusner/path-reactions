% !TEX root =  ../main.tex


\begin{figure*}[t!]
\centering
\includegraphics[width=\textwidth]{reaction_diagram}
\caption{\emph{(Left)} The reaction product prediction problem: Given the reactants and reagents, predict the structure of the product. \emph{(Right)} The reaction mechanism prediction problem: Given the reactants and reagents, predict how the reaction occurred to form the products.}
\label{fig:task-overview}

\end{figure*}


In Figure~\ref{fig:task-overview} we show the two challenges we tackle in this paper. 
On the left we show product prediction, where the goal is to predict the reaction products, given a set of reactants and reagents. However, for this task we do not care {\em how} the reactants react.
 This job of finding the {\em how} is the target of reaction mechanism prediction. 
 Before describing how our model predicts mechanisms, we use this section to detail the types of reactions we consider in this paper, and their properties.



\vspace{-0.15cm}
\paragraph{Molecules and Chemical reactions.}


Organic molecules (those involving predominantly carbon) can be modeled as a graph structure, where each node is an atom and each edge is a covalent bond.
These covalent bonds represent the fact that 
one or more pairs of electrons are shared between the atoms that the bond connects. 


Just as electrons describe the current structure of molecules, 
they also describe how molecules react with other molecules to produce new ones. All chemical reactions involve the stepwise movement of electrons along the atoms in a set of reactant molecules. 
This movement causes the formation and breaking of chemical bonds that changes the reactants into a new set of product molecules \cite{herges1994coarctate}. 
%
Reaction mechanisms can be classified by the topology of their "electron-pushing arrows". Here, the class of reactions with linear electron flow topology is by far the most important, following by those with cyclic topology \citep{herges1994coarctate}.

In this work, we will only consider reactions with linear topology that involve the movement of pairs of electrons.


\vspace{-0.15cm}
\paragraph{Reactions as single electron paths.}
If reactions fall into this class, then a chemical reaction can be modeled as pairs of electrons moving in a \emph{single path} through the reactant atoms. 
Further, this electron path will alternately remove existing bonds in molecules, and form new ones. We show this alternating structure in the right hand part of Figure \ref{fig:task-overview}. 
The reaction formally starts by taking the pair of electrons between the Li and C atoms and moving them to the C atom (step 1); this is a remove bond step. 
Next comes an add step where electrons are moved from the C atom to form a bond between the two reactant molecules (step 2).
Then a pair of electrons are removed between the C and O atoms and moved to the O atom, giving rise to the products (step 3). 
Predicting the final product is thus a byproduct of predicting this series of electron steps.

However, there are a number of benefits of predicting electron paths over predicting the outcomes of reactions directly (as is done in previous work \cite{jin2017predicting,schwaller2017found}):
\begin{itemize}
\item \textbf{Easy to interpret}: If the model makes a mistake, it is easy to see where, and possibly why, it goes wrong by comparing the steps of the path with the correct steps.
\item \textbf{Sparse}: Reactions often only affect between 3 and 7 atoms out of anywhere from 10-50 reactant atoms. Modeling the reaction as a path allows us to exploit this sparsity.
\item \textbf{Chemically consistent}: Learning a path allows us to easily incorporate chemical constraints, such as the alternating removal and addition of bonds, among others. 
\item \textbf{Generalizable}: As reaction paths follow similar trends in different molecules, our model naturally generalizes to unseen reactions. %Learning to combine lower-level abstractions of chemistry potentially allows us to generalize better.
\end{itemize}
The only other work we are aware of to use machine learning to predict reaction mechanisms are \cite{fooshee2018deep,kayala2012reactionpredictor,kayala2011learning}. All of these model a chemical reaction as an interaction between atoms which function as electron donors and those which function as electron acceptors. They predict the reaction mechanism via two independent models: one that identifies these likely electron sources and sinks, and another that ranks all pairwise combinations of them.
%and the reaction mechanism is then found by ranking the pairwise combinations.
These approaches rely either on complex hand-coded rules and/or hand-curated datasets, which are usually small and proprietary.

